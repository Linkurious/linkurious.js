(function(undefined){"use strict";function crush(a){var b,c,d,e=["x","y","dx","dy","old_dx","old_dy","mass","convergence","size","fixed"],f=["source","target","weight"],g=["node","centerX","centerY","size","nextSibling","firstChild","mass","massCenterX","massCenterY"];for(c=0,d=g.length;d>c;c++)b=new RegExp("rp\\(([^,]*), '"+g[c]+"'\\)","g"),a=a.replace(b,0===c?"$1":"$1 + "+c);for(c=0,d=e.length;d>c;c++)b=new RegExp("np\\(([^,]*), '"+e[c]+"'\\)","g"),a=a.replace(b,0===c?"$1":"$1 + "+c);for(c=0,d=f.length;d>c;c++)b=new RegExp("ep\\(([^,]*), '"+f[c]+"'\\)","g"),a=a.replace(b,0===c?"$1":"$1 + "+c);return a}function getWorkerFn(){var a=crush?crush(Worker.toString()):Worker.toString();return";("+a+").call(this);"}if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.layouts");var _root=this,inWebWorker=!("document"in _root),Worker=function(a){function b(){var a,b,c={},d=arguments.length;for(a=d-1;a>=0;a--)for(b in arguments[a])c[b]=arguments[a][b];return c}function c(a){var b;for(b in a)"hasOwnProperty"in a&&!a.hasOwnProperty(b)||delete a[b];return a}function d(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))}function e(a,b,c,d,e){return(e-d)*(a-b)/(c-b)+d}function f(a){return Math.acos(a.x/Math.sqrt(a.x*a.x+a.y*a.y))}function g(a,b,c,d){return{xi:-(d-b),yi:c-a,xi_prime:d-b,yi_prime:-(c-a)}}function h(a,b){return{x:(a.xi_prime-a.xi)/b,y:(a.yi_prime-a.yi)/b}}function i(a,b,c,d,e){return{x:a+(c-a)*e,y:b+(d-b)*e}}function j(a,b){if(a%u.ppn!==0)throw new Error('Invalid argument in np: "i" is not correct ('+a+").");if(a!==parseInt(a))throw new TypeError('Invalid argument in np: "i" is not an integer.');if(b in v)return a+v[b];throw new Error("ForceLink.Worker - Inexistant node property given ("+b+").")}function k(a,b){if(a%u.ppe!==0)throw new Error('Invalid argument in ep: "i" is not correct ('+a+").");if(a!==parseInt(a))throw new TypeError('Invalid argument in ep: "i" is not an integer.');if(b in w)return a+w[b];throw new Error("ForceLink.Worker - Inexistant edge property given ("+b+").")}function l(a,b){if(a%u.ppr!==0)throw new Error('Invalid argument in rp: "i" is not correct ('+a+").");if(a!==parseInt(a))throw new TypeError('Invalid argument in rp: "i" is not an integer.');if(b in x)return a+x[b];throw new Error("ForceLink.Worker - Inexistant region property given ("+b+").")}function m(a,b,c){c=c||{};q=a,r=b,u.nodesLength=q.length,u.edgesLength=r.length,n(c)}function n(a){u.settings=b(a,u.settings)}function o(){var a,b,c,m,n,o,p,t,v,w,x,y,z,A,B,C,D;for(c=0;c<u.nodesLength;c+=u.ppn)q[j(c,"old_dx")]=q[j(c,"dx")],q[j(c,"old_dy")]=q[j(c,"dy")],q[j(c,"dx")]=0,q[j(c,"dy")]=0;if(u.settings.outboundAttractionDistribution){for(v=0,c=0;c<u.nodesLength;c+=u.ppn)v+=q[j(c,"mass")];v/=u.nodesLength}if(u.settings.barnesHutOptimize){var E,F,G=1/0,H=-(1/0),I=1/0,J=-(1/0);for(s=[],c=0;c<u.nodesLength;c+=u.ppn)G=Math.min(G,q[j(c,"x")]),H=Math.max(H,q[j(c,"x")]),I=Math.min(I,q[j(c,"y")]),J=Math.max(J,q[j(c,"y")]);for(s[l(0,"node")]=-1,s[l(0,"centerX")]=(G+H)/2,s[l(0,"centerY")]=(I+J)/2,s[l(0,"size")]=Math.max(H-G,J-I),s[l(0,"nextSibling")]=-1,s[l(0,"firstChild")]=-1,s[l(0,"mass")]=0,s[l(0,"massCenterX")]=0,s[l(0,"massCenterY")]=0,a=1,c=0;c<u.nodesLength;c+=u.ppn)for(b=0;;)if(s[l(b,"firstChild")]>=0)E=q[j(c,"x")]<s[l(b,"centerX")]?q[j(c,"y")]<s[l(b,"centerY")]?s[l(b,"firstChild")]:s[l(b,"firstChild")]+u.ppr:q[j(c,"y")]<s[l(b,"centerY")]?s[l(b,"firstChild")]+2*u.ppr:s[l(b,"firstChild")]+3*u.ppr,s[l(b,"massCenterX")]=(s[l(b,"massCenterX")]*s[l(b,"mass")]+q[j(c,"x")]*q[j(c,"mass")])/(s[l(b,"mass")]+q[j(c,"mass")]),s[l(b,"massCenterY")]=(s[l(b,"massCenterY")]*s[l(b,"mass")]+q[j(c,"y")]*q[j(c,"mass")])/(s[l(b,"mass")]+q[j(c,"mass")]),s[l(b,"mass")]+=q[j(c,"mass")],b=E;else{if(s[l(b,"node")]<0){s[l(b,"node")]=c;break}if(s[l(b,"firstChild")]=a*u.ppr,p=s[l(b,"size")]/2,t=s[l(b,"firstChild")],s[l(t,"node")]=-1,s[l(t,"centerX")]=s[l(b,"centerX")]-p,s[l(t,"centerY")]=s[l(b,"centerY")]-p,s[l(t,"size")]=p,s[l(t,"nextSibling")]=t+u.ppr,s[l(t,"firstChild")]=-1,s[l(t,"mass")]=0,s[l(t,"massCenterX")]=0,s[l(t,"massCenterY")]=0,t+=u.ppr,s[l(t,"node")]=-1,s[l(t,"centerX")]=s[l(b,"centerX")]-p,s[l(t,"centerY")]=s[l(b,"centerY")]+p,s[l(t,"size")]=p,s[l(t,"nextSibling")]=t+u.ppr,s[l(t,"firstChild")]=-1,s[l(t,"mass")]=0,s[l(t,"massCenterX")]=0,s[l(t,"massCenterY")]=0,t+=u.ppr,s[l(t,"node")]=-1,s[l(t,"centerX")]=s[l(b,"centerX")]+p,s[l(t,"centerY")]=s[l(b,"centerY")]-p,s[l(t,"size")]=p,s[l(t,"nextSibling")]=t+u.ppr,s[l(t,"firstChild")]=-1,s[l(t,"mass")]=0,s[l(t,"massCenterX")]=0,s[l(t,"massCenterY")]=0,t+=u.ppr,s[l(t,"node")]=-1,s[l(t,"centerX")]=s[l(b,"centerX")]+p,s[l(t,"centerY")]=s[l(b,"centerY")]+p,s[l(t,"size")]=p,s[l(t,"nextSibling")]=s[l(b,"nextSibling")],s[l(t,"firstChild")]=-1,s[l(t,"mass")]=0,s[l(t,"massCenterX")]=0,s[l(t,"massCenterY")]=0,a+=4,E=q[j(s[l(b,"node")],"x")]<s[l(b,"centerX")]?q[j(s[l(b,"node")],"y")]<s[l(b,"centerY")]?s[l(b,"firstChild")]:s[l(b,"firstChild")]+u.ppr:q[j(s[l(b,"node")],"y")]<s[l(b,"centerY")]?s[l(b,"firstChild")]+2*u.ppr:s[l(b,"firstChild")]+3*u.ppr,s[l(b,"mass")]=q[j(s[l(b,"node")],"mass")],s[l(b,"massCenterX")]=q[j(s[l(b,"node")],"x")],s[l(b,"massCenterY")]=q[j(s[l(b,"node")],"y")],s[l(E,"node")]=s[l(b,"node")],s[l(b,"node")]=-1,F=q[j(c,"x")]<s[l(b,"centerX")]?q[j(c,"y")]<s[l(b,"centerY")]?s[l(b,"firstChild")]:s[l(b,"firstChild")]+u.ppr:q[j(c,"y")]<s[l(b,"centerY")]?s[l(b,"firstChild")]+2*u.ppr:s[l(b,"firstChild")]+3*u.ppr,E!==F){s[l(F,"node")]=c;break}b=E}}if(u.settings.barnesHutOptimize)for(w=u.settings.scalingRatio,c=0;c<u.nodesLength;c+=u.ppn)for(b=0;;)if(s[l(b,"firstChild")]>=0){if(C=Math.sqrt((q[j(c,"x")]-s[l(b,"massCenterX")])*(q[j(c,"x")]-s[l(b,"massCenterX")])+(q[j(c,"y")]-s[l(b,"massCenterY")])*(q[j(c,"y")]-s[l(b,"massCenterY")])),2*s[l(b,"size")]/C<u.settings.barnesHutTheta){if(x=q[j(c,"x")]-s[l(b,"massCenterX")],y=q[j(c,"y")]-s[l(b,"massCenterY")],u.settings.adjustSizes?C>0?(D=w*q[j(c,"mass")]*s[l(b,"mass")]/C/C,q[j(c,"dx")]+=x*D,q[j(c,"dy")]+=y*D):0>C&&(D=-w*q[j(c,"mass")]*s[l(b,"mass")]/C,q[j(c,"dx")]+=x*D,q[j(c,"dy")]+=y*D):C>0&&(D=w*q[j(c,"mass")]*s[l(b,"mass")]/C/C,q[j(c,"dx")]+=x*D,q[j(c,"dy")]+=y*D),s[l(b,"nextSibling")]<0)break;b=s[l(b,"nextSibling")];continue}b=s[l(b,"firstChild")]}else{if(s[l(b,"node")]>=0&&s[l(b,"node")]!==c&&(x=q[j(c,"x")]-q[j(s[l(b,"node")],"x")],y=q[j(c,"y")]-q[j(s[l(b,"node")],"y")],C=Math.sqrt(x*x+y*y),u.settings.adjustSizes?C>0?(D=w*q[j(c,"mass")]*q[j(s[l(b,"node")],"mass")]/C/C,q[j(c,"dx")]+=x*D,q[j(c,"dy")]+=y*D):0>C&&(D=-w*q[j(c,"mass")]*q[j(s[l(b,"node")],"mass")]/C,q[j(c,"dx")]+=x*D,q[j(c,"dy")]+=y*D):C>0&&(D=w*q[j(c,"mass")]*q[j(s[l(b,"node")],"mass")]/C/C,q[j(c,"dx")]+=x*D,q[j(c,"dy")]+=y*D)),s[l(b,"nextSibling")]<0)break;b=s[l(b,"nextSibling")]}else for(w=u.settings.scalingRatio,m=0;m<u.nodesLength;m+=u.ppn)for(n=0;m>n;n+=u.ppn)x=q[j(m,"x")]-q[j(n,"x")],y=q[j(m,"y")]-q[j(n,"y")],u.settings.adjustSizes?(C=Math.sqrt(x*x+y*y)-q[j(m,"size")]-q[j(n,"size")],C>0?(D=w*q[j(m,"mass")]*q[j(n,"mass")]/C/C,q[j(m,"dx")]+=x*D,q[j(m,"dy")]+=y*D,q[j(n,"dx")]+=x*D,q[j(n,"dy")]+=y*D):0>C&&(D=100*w*q[j(m,"mass")]*q[j(n,"mass")],q[j(m,"dx")]+=x*D,q[j(m,"dy")]+=y*D,q[j(n,"dx")]-=x*D,q[j(n,"dy")]-=y*D)):(C=Math.sqrt(x*x+y*y),C>0&&(D=w*q[j(m,"mass")]*q[j(n,"mass")]/C/C,q[j(m,"dx")]+=x*D,q[j(m,"dy")]+=y*D,q[j(n,"dx")]-=x*D,q[j(n,"dy")]-=y*D));for(t=u.settings.gravity/u.settings.scalingRatio,w=u.settings.scalingRatio,c=0;c<u.nodesLength;c+=u.ppn)D=0,x=q[j(c,"x")],y=q[j(c,"y")],C=Math.sqrt(x*x+y*y),u.settings.strongGravityMode?C>0&&(D=w*q[j(c,"mass")]*t):C>0&&(D=w*q[j(c,"mass")]*t/C),q[j(c,"dx")]-=x*D,q[j(c,"dy")]-=y*D;for(w=1*(u.settings.outboundAttractionDistribution?v:1),o=0;o<u.edgesLength;o+=u.ppe)m=r[k(o,"source")],n=r[k(o,"target")],p=r[k(o,"weight")],B=Math.pow(p,u.settings.edgeWeightInfluence),x=q[j(m,"x")]-q[j(n,"x")],y=q[j(m,"y")]-q[j(n,"y")],u.settings.adjustSizes?(C=Math.sqrt(x*x+y*y-q[j(m,"size")]-q[j(n,"size")]),u.settings.linLogMode?u.settings.outboundAttractionDistribution?C>0&&(D=-w*B*Math.log(1+C)/C/q[j(m,"mass")]):C>0&&(D=-w*B*Math.log(1+C)/C):u.settings.outboundAttractionDistribution?C>0&&(D=-w*B/q[j(m,"mass")]):C>0&&(D=-w*B)):(C=Math.sqrt(x*x+y*y),u.settings.linLogMode?u.settings.outboundAttractionDistribution?C>0&&(D=-w*B*Math.log(1+C)/C/q[j(m,"mass")]):C>0&&(D=-w*B*Math.log(1+C)/C):u.settings.outboundAttractionDistribution?(C=1,D=-w*B/q[j(m,"mass")]):(C=1,D=-w*B)),C>0&&(q[j(m,"dx")]+=x*D,q[j(m,"dy")]+=y*D,q[j(n,"dx")]-=x*D,q[j(n,"dy")]-=y*D);var K,L,M,N,O=0;if(u.settings.adjustSizes)for(c=0;c<u.nodesLength;c+=u.ppn)q[j(c,"fixed")]||(K=Math.sqrt(q[j(c,"dx")]*q[j(c,"dx")]+q[j(c,"dy")]*q[j(c,"dy")]),K>u.maxForce&&(q[j(c,"dx")]=q[j(c,"dx")]*u.maxForce/K,q[j(c,"dy")]=q[j(c,"dy")]*u.maxForce/K),L=q[j(c,"mass")]*Math.sqrt((q[j(c,"old_dx")]-q[j(c,"dx")])*(q[j(c,"old_dx")]-q[j(c,"dx")])+(q[j(c,"old_dy")]-q[j(c,"dy")])*(q[j(c,"old_dy")]-q[j(c,"dy")])),M=Math.sqrt((q[j(c,"old_dx")]+q[j(c,"dx")])*(q[j(c,"old_dx")]+q[j(c,"dx")])+(q[j(c,"old_dy")]+q[j(c,"dy")])*(q[j(c,"old_dy")]+q[j(c,"dy")]))/2,N=.1*Math.log(1+M)/(1+Math.sqrt(L)),z=q[j(c,"x")],A=q[j(c,"y")],q[j(c,"x")]=q[j(c,"x")]+q[j(c,"dx")]*(N/u.settings.slowDown),q[j(c,"y")]=q[j(c,"y")]+q[j(c,"dy")]*(N/u.settings.slowDown),x=q[j(c,"x")],y=q[j(c,"y")],C=Math.sqrt((x-z)*(x-z)+(y-A)*(y-A)),O+=C);else for(c=0;c<u.nodesLength;c+=u.ppn)q[j(c,"fixed")]||(L=q[j(c,"mass")]*Math.sqrt((q[j(c,"old_dx")]-q[j(c,"dx")])*(q[j(c,"old_dx")]-q[j(c,"dx")])+(q[j(c,"old_dy")]-q[j(c,"dy")])*(q[j(c,"old_dy")]-q[j(c,"dy")])),M=Math.sqrt((q[j(c,"old_dx")]+q[j(c,"dx")])*(q[j(c,"old_dx")]+q[j(c,"dx")])+(q[j(c,"old_dy")]+q[j(c,"dy")])*(q[j(c,"old_dy")]+q[j(c,"dy")]))/2,N=q[j(c,"convergence")]*Math.log(1+M)/(1+Math.sqrt(L)),q[j(c,"convergence")]=Math.min(1,Math.sqrt(N*(q[j(c,"dx")]*q[j(c,"dx")]+q[j(c,"dy")]*q[j(c,"dy")])/(1+Math.sqrt(L)))),z=q[j(c,"x")],A=q[j(c,"y")],q[j(c,"x")]=q[j(c,"x")]+q[j(c,"dx")]*(N/u.settings.slowDown),q[j(c,"y")]=q[j(c,"y")]+q[j(c,"dy")]*(N/u.settings.slowDown),x=q[j(c,"x")],y=q[j(c,"y")],C=Math.sqrt((x-z)*(x-z)+(y-A)*(y-A)),O+=C);if(u.iterations++,u.settings.autoStop&&(u.converged=u.iterations>u.settings.maxIterations||O/u.nodesLength<u.settings.avgDistanceThreshold,u.converged&&u.settings.alignNodeSiblings)){var P,Q,R={},S={};for(o=0;o<u.edgesLength;o+=u.ppe)m=r[k(o,"source")],n=r[k(o,"target")],m!==n&&(R[m]=R[m]||{},R[n]=R[n]||{},R[m][n]=!0,R[n][m]=!0);Object.keys(R).forEach(function(a){a=~~a,Q=Object.keys(R[a]),2==Q.length&&(P=Q[0]+";"+Q[1],P in S?S[P].push(a):(P=Q[1]+";"+Q[0],S[P]||(S[P]=[~~Q[1],~~Q[0]]),S[P].push(a)))});var T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga=u.settings.nodeSiblingsAngleMin;Object.keys(S).forEach(function(a){if(U=S[a].shift(),V=S[a].shift(),T=S[a].filter(function(a){return!q[j(a,"fixed")]}),1!=T.length){if(Y=q[j(U,"x")],Z=q[j(U,"y")],$=q[j(V,"x")],_=q[j(V,"y")],W=Object.keys(R[U]).length,X=Object.keys(R[V]).length,aa=e(W/(W+X),0,1,.25,.75),ca=i(Y,Z,$,_,aa),da=g(Y,Z,$,_),ba=d(Y,Z,$,_),ea=h(da,ba),fa=f(ea),2*ga>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");ga>0&&(ga>fa||fa>Math.PI-ga&&fa<=Math.PI?ea={x:2*Math.cos(Math.PI-ga),y:2*Math.sin(Math.PI-ga)}:(fa>2*Math.PI-ga||fa>=Math.PI&&fa<Math.PI+ga)&&(ea={x:2*Math.cos(ga),y:2*Math.sin(ga)}));var b=0,c=1,k=1;T.length%2==1&&(k=0,b=1);for(var l=0;l<T.length;l++)q[j(T[l],"x")]=ca.x+c*ea.x*k*(b||l>=2?u.settings.nodeSiblingsScale:2*u.settings.nodeSiblingsScale/3),q[j(T[l],"y")]=ca.y+c*ea.y*k*(b||l>=2?u.settings.nodeSiblingsScale:2*u.settings.nodeSiblingsScale/3),c=-c,k+=(l+b)%2}})}}function p(a){for(var b=0;a>b;b++)o();t()}var q,r,s,t,u={ppn:10,ppe:3,ppr:9,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:1,iterationsPerRender:1,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!1,alignNodeSiblings:!1,nodeSiblingsScale:1,nodeSiblingsAngleMin:0}},v={x:0,y:1,dx:2,dy:3,old_dx:4,old_dy:5,mass:6,convergence:7,size:8,fixed:9},w={source:0,target:1,weight:2},x={node:0,centerX:1,centerY:2,size:3,nextSibling:4,firstChild:5,mass:6,massCenterX:7,massCenterY:8};t="undefined"!=typeof window&&window.document?function(){if(!u.autoStop||u.converged){var a;document.createEvent?(a=document.createEvent("Event"),a.initEvent("newCoords",!0,!1)):(a=document.createEventObject(),a.eventType="newCoords"),a.eventName="newCoords",a.data={nodes:q.buffer,converged:u.converged},requestAnimationFrame(function(){document.dispatchEvent(a)})}}:function(){(!u.autoStop||u.converged)&&self.postMessage({nodes:q.buffer,converged:u.converged},[q.buffer])};var y=function(a){switch(a.data.action){case"start":m(new Float32Array(a.data.nodes),new Float32Array(a.data.edges),a.data.config),p(u.settings.startingIterations);break;case"loop":q=new Float32Array(a.data.nodes),p(u.settings.iterationsPerRender);break;case"config":n(a.data.config);break;case"kill":c(u),q=null,r=null,s=null,self.removeEventListener("message",y)}};self.addEventListener("message",y)};if(inWebWorker)eval(getWorkerFn());else{if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.layouts.getForceLinkWorker=getWorkerFn}}).call(this);
//# sourceMappingURL=worker.js.map